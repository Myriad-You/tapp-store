<!-- Weather Widget 2x2 -->
<div class="widget-weather" id="weather-widget">
  <div class="icon">ğŸŒ¤ï¸</div>
  <div class="temp">--Â°C</div>
  <div class="location">åŠ è½½ä¸­...</div>
</div>

<script>
(async function() {
  try {
    // è·å–è®¾ç½®
    const settings = await Tapp.storage.get('settings') || {};
    const units = settings.units || 'metric';
    
    // è°ƒç”¨å£°æ˜çš„ API è·å–å¤©æ°”
    const response = await Tapp.api('getWeather', { units });
    
    if (response.success) {
      const data = response.data;
      const weatherIcons = {
        '01d': 'â˜€ï¸', '01n': 'ğŸŒ™',
        '02d': 'â›…', '02n': 'â˜ï¸',
        '03d': 'â˜ï¸', '03n': 'â˜ï¸',
        '04d': 'â˜ï¸', '04n': 'â˜ï¸',
        '09d': 'ğŸŒ§ï¸', '09n': 'ğŸŒ§ï¸',
        '10d': 'ğŸŒ¦ï¸', '10n': 'ğŸŒ§ï¸',
        '11d': 'â›ˆï¸', '11n': 'â›ˆï¸',
        '13d': 'ğŸŒ¨ï¸', '13n': 'ğŸŒ¨ï¸',
        '50d': 'ğŸŒ«ï¸', '50n': 'ğŸŒ«ï¸',
      };
      
      const icon = weatherIcons[data.weather[0]?.icon] || 'ğŸŒ¤ï¸';
      const temp = Math.round(data.main.temp);
      const unit = units === 'metric' ? 'Â°C' : 'Â°F';
      
      document.querySelector('.icon').textContent = icon;
      document.querySelector('.temp').textContent = `${temp}${unit}`;
      document.querySelector('.location').textContent = data.name;
    }
  } catch (error) {
    console.error('[Weather Widget] Error:', error);
    document.querySelector('.location').textContent = 'è·å–å¤±è´¥';
  }
})();
</script>
