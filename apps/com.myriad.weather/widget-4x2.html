<!-- Weather Widget 4x2 -->
<div class="widget-weather widget-wide" id="weather-widget">
  <div class="weather-left">
    <div class="icon">ğŸŒ¤ï¸</div>
    <div class="temp">--Â°C</div>
  </div>
  <div class="weather-right">
    <div class="location">åŠ è½½ä¸­...</div>
    <div class="description">--</div>
    <div class="details">
      <span class="humidity">ğŸ’§ --%</span>
      <span class="wind">ğŸ’¨ -- m/s</span>
    </div>
  </div>
</div>

<style>
.widget-wide {
  flex-direction: row !important;
  padding: 16px !important;
  gap: 16px;
}

.weather-left {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}

.weather-left .icon {
  font-size: 40px;
}

.weather-left .temp {
  font-size: 28px;
  font-weight: 600;
}

.weather-right {
  flex: 1;
  display: flex;
  flex-direction: column;
  justify-content: center;
  gap: 4px;
}

.weather-right .location {
  font-size: 16px;
  font-weight: 500;
}

.weather-right .description {
  font-size: 14px;
  opacity: 0.9;
  text-transform: capitalize;
}

.weather-right .details {
  display: flex;
  gap: 12px;
  margin-top: 4px;
  font-size: 12px;
  opacity: 0.8;
}
</style>

<script>
(async function() {
  try {
    const settings = await Tapp.storage.get('settings') || {};
    const units = settings.units || 'metric';
    
    const response = await Tapp.api('getWeather', { units });
    
    if (response.success) {
      const data = response.data;
      const weatherIcons = {
        '01d': 'â˜€ï¸', '01n': 'ğŸŒ™',
        '02d': 'â›…', '02n': 'â˜ï¸',
        '03d': 'â˜ï¸', '03n': 'â˜ï¸',
        '04d': 'â˜ï¸', '04n': 'â˜ï¸',
        '09d': 'ğŸŒ§ï¸', '09n': 'ğŸŒ§ï¸',
        '10d': 'ğŸŒ¦ï¸', '10n': 'ğŸŒ§ï¸',
        '11d': 'â›ˆï¸', '11n': 'â›ˆï¸',
        '13d': 'ğŸŒ¨ï¸', '13n': 'ğŸŒ¨ï¸',
        '50d': 'ğŸŒ«ï¸', '50n': 'ğŸŒ«ï¸',
      };
      
      const icon = weatherIcons[data.weather[0]?.icon] || 'ğŸŒ¤ï¸';
      const temp = Math.round(data.main.temp);
      const unit = units === 'metric' ? 'Â°C' : 'Â°F';
      
      document.querySelector('.icon').textContent = icon;
      document.querySelector('.temp').textContent = `${temp}${unit}`;
      document.querySelector('.location').textContent = data.name;
      document.querySelector('.description').textContent = data.weather[0]?.description || '';
      document.querySelector('.humidity').textContent = `ğŸ’§ ${data.main.humidity}%`;
      document.querySelector('.wind').textContent = `ğŸ’¨ ${data.wind.speed} m/s`;
    }
  } catch (error) {
    console.error('[Weather Widget] Error:', error);
    document.querySelector('.location').textContent = 'è·å–å¤±è´¥';
  }
})();
</script>
